---
title: "OAuth"
pubDatetime: 2024-02-03T14:26:09.000Z
full_path: "src/content/blog/oauth.md"
description: "null"
tags: 
  - "ê¸°íƒ€"
---

### TOC

## ðŸ“Œ OAuth 2.0 
OAuth 2ëŠ” íŽ˜ì´ìŠ¤ë¶, ê¹ƒí—ˆë¸Œ, êµ¬ê¸€ê³¼ ê°™ì€ ì‘ìš© í”„ë¡œê·¸ëž¨ë“¤ì´ HTTP ì„œë¹„ìŠ¤ì—ì„œ ì‚¬ìš©ìž ê³„ì •ì— ëŒ€í•œ ì œí•œëœ ì ‘ê·¼ì„ ì–»ì„ ìˆ˜ ìžˆë„ë¡ í•˜ëŠ” ê¶Œí•œ ë¶€ì—¬ í”„ë ˆìž„ì›Œí¬ì´ë‹¤.

## ðŸ“Œ ì—­í• 

### client
- ì‚¬ìš©ìžì˜ ê³„ì •ì— ì ‘ì†í• ë ¤ëŠ” í”„ë¡œê·¸ëž¨  
- ë¦¬ì†ŒìŠ¤ ì„œë²„ì— ì ‘ì†í•´ì„œ ìžì›ì„ ê°€ì ¸ê°„ë‹¤.  
ex) ìš°ë¦¬ê°€ ë§Œë“  ì„œë¹„ìŠ¤  
### Resource Owner
- ë¦¬ì†ŒìŠ¤ ì†Œìœ ìžëŠ” ìžì‹ ì˜ ê³„ì • ì¼ë¶€ì— ì•¡ì„¸ìŠ¤ ê¶Œí•œì„ ë¶€ì—¬í•˜ëŠ” ì‚¬ìš©ìž  
- ex) user  
### Resource Server  
- ì‚¬ìš©ìžì˜ ì •ë³´ì— ì ‘ê·¼í•˜ë ¤ëŠ” api  
- ë°ì´í„°ë¥¼ ê°€ì§€ê³  ìžˆëŠ” ì„œë²„   
- ex) facebook,google ë°ì´í„° ì„œë²„  
### Authorization Server
- ì¸ì¦ê³¼ ê´€ë ¨ëœ ë°ì´í„°ë¥¼ ì²˜ë¦¬í•˜ëŠ” ì„œë²„   
- ì‚¬ìš©ìžê°€ ìš”ì²­ì„ ìŠ¹ì¸í•˜ê±°ë‚˜ ê±°ë¶€í•˜ëŠ” ì¸í„°íŽ˜ì´ìŠ¤ë¥¼ ì œê³µí•˜ëŠ” ì„œë²„  
- ì†Œê·œëª¨ êµ¬í˜„ì—ì„œëŠ” api ì„œë²„ì™€ ë™ì¼í•œ ì„œë²„ì¼ ìˆ˜ ìžˆì§€ë§Œ ëŒ€ê·œëª¨ êµ¬í˜„ì—ì„œëŠ” ë³„ë„ì˜ êµ¬ì„± ìš”ì†Œë¡œ êµ¬ì¶•ë˜ëŠ” ê²½ìš°ê°€ ë§Žë‹¤.
ex) facebook,google ì¸ì¦ ì„œë²„ 
## ðŸ“Œ authentication(ì¸ì¦)ê³¼ authorization(ì¸ê°€)ì˜ ì°¨ì´
### ì¸ì¦
- ì‚¬ìš©ìžê°€ ìžì‹ ì„ ì‹ë³„í•˜ëŠ” í”„ë¡œì„¸ìŠ¤
- "ëˆ„êµ¬"ì¸ì§€ í™•ì¸í•˜ê³  ì‚¬ìš©ìžì˜ ì‹ ì›ì„ í™•ì¸í•œë‹¤.
- ex)  ì‚¬ìš©ìžê°€ ë¡œê·¸ì¸í•˜ê³  ìžì‹ ì˜ ì•„ì´ë””ì™€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì œê³µí•˜ì—¬ ì‹œìŠ¤í…œì— ë¡œê·¸ì¸í•  ë•Œ ì´ë£¨ì–´ì§€ëŠ” ê³¼ì •
### ì¸ê°€
- ì¸ì¦ í›„ ì–´ë–¤ ìž‘ì—…ì´ë‚˜ ìžì›ì— ëŒ€í•œ ì ‘ê·¼ ê¶Œí•œì„ ë¶€ì—¬í•˜ê±°ë‚˜ ê±°ë¶€í•˜ëŠ” í”„ë¡œì„¸ìŠ¤
- "ë¬´ì—‡"ì— ëŒ€í•œ ì—‘ì„¸ìŠ¤ ê¶Œí•œì„ ê´€ë¦¬í•œë‹¤.
- ex) ë¡œê·¸ì¸ í›„ì— íŠ¹ì • íŒŒì¼ì— ëŒ€í•œ ì½ê¸° ë˜ëŠ” ì“°ê¸° ê¶Œí•œì„ ì–»ëŠ” ê³¼ì •

## ðŸ“Œ Abstract Protocol Flow 
![image](./ec7cdc0f-6524-48e3-8406-b4c4d31d7769.png)

(A) clientëŠ” resource ownerì—ê²Œ ê¶Œí•œì„ ìš”ì²­í•œë‹¤.   
(B) resource ownerê°€ ê¶Œí•œ ìš”ì²­ì„ ìŠ¹ì¸í•˜ë©´ clientëŠ” ê¶Œí•œ ë¶€ì—¬ë¥¼ ë°›ëŠ”ë‹¤.   
(C) clientëŠ” ìžì‹ ì˜ ì‹ ì›ì— ëŒ€í•œ ì¸ì¦ì„ ì œì‹œí•¨ìœ¼ë¡œì¨ authorization serverì— ì—‘ì„¸ìŠ¤ í† í°ì„ ìš”ì²­í•˜ê³  ,ì¸ê°€ í—ˆê°€ë¥¼ ë°›ëŠ”ë‹¤.  
(D) client idê°€ ì¸ì¦ë˜ê³  ì¸ê°€ í—ˆê°€ê°€ ìœ íš¨í•œ ê²½ìš° , authorization serverëŠ” clientì— ì—‘ì„¸ìŠ¤ í† í°ì„ ë°œí–‰í•œë‹¤.   
(E) client ëŠ” resource serverì— ë¦¬ì†ŒìŠ¤ë¥¼ ìš”ì²­í•˜ê³  ì¸ì¦ì„ ìœ„í•œ ì—‘ì„¸ìŠ¤ í† í°ì„ ì œì‹œí•œë‹¤.  
(F) ì—‘ì„¸ìŠ¤ í† í°ì´ ìœ íš¨í•œ ê²½ìš° resource serverëŠ” ë¦¬ì†ŒìŠ¤ë¥¼ clientì—ê²Œ ì œê³µí•œë‹¤.  

: ì‹¤ì œ ê³¼ì •ì€ ê¶Œí•œ ë¶€ì—¬ ìœ í˜•ì— ë”°ë¼ ë‹¤ë¥´ì§€ë§Œ ì¼ë°˜ì ì¸ ê³¼ì •ì´ë‹¤  

## ðŸ“Œë“±ë¡

OAuthë¥¼ ì‚¬ìš©í•˜ê¸° ì „ì— ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì„œë¹„ìŠ¤ì— ë“±ë¡í•´ì•¼í•œë‹¤.ë“±ë¡í•  ë•Œ ì£¼ë¡œ ì• í”Œë¦¬ì¼€ì´ì…˜ ì´ë¦„ê³¼ ì›¹ì‚¬ì´íŠ¸ ë“± ê¸°ë³¸ì •ë³´ë¥¼ ìž…ë ¥í•œë‹¤. ë˜í•œ ì‚¬ìš©ìžë¥¼ ë¦¬ë””ë ‰ì…˜í•  redirect urlë¥¼ ë“±ë¡í•´ì•¼í•œë‹¤.  
### Redirect URLs
ë“±ë¡í•œ urlë¡œë§Œ ë¦¬ë””ë ‰ì…˜í•˜ì—¬ ì¼ë¶€ ê³µê²©ì„ ë°©ì§€í•˜ëŠ”ë° ë„ì›€ì´ ëœë‹¤.  
redirect urlëŠ” httpsë¥¼ í†µí•´ ì œê³µë˜ë©° ì´ë¥¼ í†µí•´ ì¸ì¦ ê³¼ì •ì—ì„œ í† í°ì´ ê°€ë¡œì±„ì§€ëŠ” ê²ƒì„ ë°©ì§€í•  ìˆ˜ ìžˆë‹¤.  

### Client ID and Secret
ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë“±ë¡í•˜ë©´ client IDì™€ client secretì„ ë°›ê²Œ ëœë‹¤. client idëŠ” ê³µê°œ ì •ë³´ì´ë©° ë¡œê·¸ì¸ urlì„ êµ¬ì¶•í•˜ëŠ”ë° ì‚¬ìš©ë˜ê±°ë‚˜ íŽ˜ì´ì§€ì˜ ìžë°”ìŠ¤í¬ë¦½íŠ¸ ì†ŒìŠ¤ ì½”ë“œì— í¬í•¨ëœë‹¤. client secretì€ ë°˜ë“œì‹œ ë¹„ë°€ë¡œ ìœ ì§€ë˜ì–´ì•¼í•œë‹¤. 


## ðŸ“ŒAuthorization Grant
- ìœ„ abstract protocol flowì˜ ì²˜ìŒ 4ë‹¨ê³„ëŠ” ì¸ê°€ë¶€ì—¬ì™€ ì—‘ì„¸ìŠ¤ í† í°ì„ ì–»ëŠ”ê²ƒì„ ë‹¤ë£¬ë‹¤.
- authorization grant ìœ í˜•ì€ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì¸ê°€ë¥¼ ìš”ì²­í•˜ëŠ” ë°©ë²•ê³¼ apiê°€ ì§€ì›í•˜ëŠ” í—ˆê°€ ìš”ì²­ì— ë”°ë¼ ë‹¬ë¼ì§„ë‹¤.
- ouath2ëŠ” ì„¸ê°€ì§€ ì£¼ìš” í—ˆê°€ ìœ í˜•ì´ ìžˆë‹¤.
  1. Authorization Code : ì„œë²„ ì¸¡ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ì‚¬ìš©ëœë‹¤.
  2. Client Credentials : api ì—‘ì„¸ìŠ¤ ê¶Œí•œì´ ìžˆëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ì‚¬ìš©ëœë‹¤.
  3. Device Code : ë¸Œë¼ìš°ì €ê°€ ì—†ê±°ë‚˜ ìž…ë ¥ ì œí•œì´ ìžˆëŠ” ìž¥ì¹˜ì—ì„œ ì‚¬ìš©ëœë‹¤.
### âœ¨Authorization Code
- ì†ŒìŠ¤ ì½”ë“œê°€ ê³µê°œì ìœ¼ë¡œ ë…¸ì¶œë˜ì§€ ì•ŠëŠ” server-side ì• í”Œë¦¬ì¼€ì´ì…˜ì— ìµœì í™” ë˜ì–´ìžˆë‹¤.
- HTTP ë¦¬ë‹¤ì´ë ‰ì…˜ì„ í† í•´ resource ownerê°€ ì§ì ‘ ì½”ë“œë¥¼ íšë“í•˜ëŠ” ë°©ì‹ì´ë‹¤.
- ê°€ìž¥ ëŒ€í‘œì ìœ¼ë¡œ ì‚¬ìš©ëœë‹¤.
![image](./f358c491-391d-4282-9b0a-e560e44b6f0d.png)
#### Step 1 - Authorization Code link
```
https://example.com/login/oauth/authorize?client_id=YOUR_CLIENT_ID&redirect_uri=YOUR_REDIRECT_URI&scope=SCOPE&response_type=code
```
resource ownerì—ê²Œ ë‹¤ìŒê³¼ ê°™ì€ ë§í¬ë¥¼ ì¤€ë‹¤.  
`https://example.com/login/oauth/authorize**` : api ìŠ¹ì¸ ì—”ë“œ í¬ì¸íŠ¸
`client_id=YOUR_CLIENT_ID` : client id
`redirect_uri=YOUR_REDIRECT_URI` : ì¸ì¦ ì½”ë“œê°€ ë¶€ì—¬ëœ ë’¤ ë¦¬ë‹¤ì´ë ‰íŠ¸ í•  url
`response_type=code` : ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì¸ì¦ ì½”ë“œ ë¶€ì—¬ì„ ìš”ì²­í•˜ê³  ìžˆìŒì„ ì§€ì •í•œë‹¤.
`scope=SCOPE` : ì• í”Œë ˆì¼€ì´ì…˜ì´ ìš”ì²­í•˜ëŠ” ì—‘ì„¸ìŠ¤ ìˆ˜ì¤€ì„ ì§€ì •í•œë‹¤.

#### Step 2 - ì‚¬ìš©ìžê°€ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ìŠ¹ì¸í•œë‹¤.
- ì‚¬ìš©ìžê°€ ë§í¬ë¥¼ í´ë¦­í•˜ë©´ ì„œë¹„ìŠ¤ì— ë¡œê·¸ì¸í•˜ì—¬ ë³¸ì¸ì˜ ì‹ ì›ì„ ì¸ì¦í•´ì•¼í•œë‹¤. ì„œë¹„ìŠ¤ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì— ëŒ€í•œ ì ‘ê·¼ì„ ìŠ¹ì¸í•˜ê±°ë‚˜ ê±°ë¶€í•˜ë„ë¡ ì„œë¹„ìŠ¤ì— ì˜í•´ ìš”êµ¬ëœë‹¤.
#### Step 3 - ì• í”Œë¦¬ì¼€ì´ì…˜ì´ authorization codeì„ ë°›ëŠ”ë‹¤.
```
https://example.com/callback?code=AUTHORIZATION_CODE
```
- ì„œë¹„ìŠ¤ëŠ” authorization codeì™€ í•¨ê»˜ ë“±ë¡ ëœ ì• í”Œë¦¬ì¼€ì´ì…˜ ë¦¬ë””ë ‰ì…˜ URIë¡œ ë¦¬ë””ë ‰ì…˜í•œë‹¤.
#### Step 4 - ì• í”Œë¦¬ì¼€ì´ì…˜ì€ ì—‘ì„¸ìŠ¤ í† í°ì„ ìš”ì²­í•œë‹¤.
```
https://example.com/login/oauth/token?client_id=CLIENT_ID&client_secret=CLIENT_SECRET&grant_type=authorization_code&code=AUTHORIZATION_CODE&redirect_uri=CALLBACK_URL
```
- ì• í”Œë¦¬ì¼€ì´ì…˜ì€ client secretì„ í¬í•¨í•œ ì¸ì¦ ì •ë³´ì™€ í•¨ê»˜ ì¸ì¦ ì½”ë“œë¥¼ api í† í° ì—”ë“œí¬ì¸íŠ¸ë¡œ ì „ë‹¬í•¨ìœ¼ë¡œì¨ apië¡œë¶€í„° ì—‘ì„¸ìŠ¤ í† í°ì„ ìš”ì²­í•œë‹¤. 
#### Step 5 - ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì—‘ì„¸ìŠ¤ í† í°ì„ ë°›ëŠ”ë‹¤.
```json
{
	"access_token":"ACCESS_TOKEN",
	"token_type":"bearer",
	"expires_in":2592000,
	"refresh_token":"REFRESH_TOKEN",
    "scope":"read",
    "uid":100101,
    "info":{.....}
}
```
- ì¸ê°€ê°€ ìœ íš¨í•œ ê²½ìš° apiëŠ” ì—‘ì„¸ìŠ¤ í† í°ì„ í¬í•¨í•˜ëŠ” ì‘ë‹µì„ ë³´ë‚¸ë‹¤.
- í† í°ì„ ì‚¬ìš©í•˜ì—¬ í† í°ì´ ë§Œë£Œë˜ê±°ë‚˜ ì·¨ì†Œë  ë•Œ ê¹Œì§€ apië¥¼ í†µí•´ ì‚¬ìš©ìž ê³„ì •ì— ì ‘ê·¼í•  ìˆ˜ ìžˆë‹¤.
- ë¦¬í”„ë ˆì‰¬ í† í°ì´ ë°œí–‰ëœ ê²½ìš°, ì›ëž˜ í† í°ì´ ë§Œë£Œëœ ê²½ìš° ìƒˆë¡œìš´ ì—‘ì„¸ìŠ¤ í† í°ì„ ìš”ì²­í•˜ëŠ” ì‚¬ìš©í•  ìˆ˜ ìžˆë‹¤.
#### ì •ë¦¬ 
```
1.  í´ë¼ì´ì–¸íŠ¸ ì• í”Œë¦¬ì¼€ì´ì…˜ì€ ì‚¬ìš©ìžë¥¼ ì¸ì¦ ì„œë²„ì˜ ë¡œê·¸ì¸ íŽ˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸í•œë‹¤. ì´ íŽ˜ì´ì§€ì—ì„œ ì‚¬ìš©ìžëŠ” ìžì‹ ì˜ ì•„ì´ë””ì™€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ìž…ë ¥í•˜ì—¬ ë¡œê·¸ì¸í•œë‹¤.
2. ì‚¬ìš©ìžê°€ ë¡œê·¸ì¸ì— ì„±ê³µí•˜ë©´, ì¸ì¦ ì„œë²„ëŠ” í´ë¼ì´ì–¸íŠ¸ ì• í”Œë¦¬ì¼€ì´ì…˜ì— ëŒ€í•œ ê¶Œí•œì„ ì‚¬ìš©ìžì—ê²Œ ìš”ì²­í•œë‹¤.
3. ì‚¬ìš©ìžê°€ í´ë¼ì´ì–¸íŠ¸ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ì ‘ê·¼ì„ í—ˆìš©í•˜ë©´, ì¸ì¦ ì„œë²„ëŠ” ì‚¬ìš©ìžë¥¼ í´ë¼ì´ì–¸íŠ¸ ì• í”Œë¦¬ì¼€ì´ì…˜ìœ¼ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸í•œë‹¤. ì´ ë¦¬ë‹¤ì´ë ‰íŠ¸ URLì—ëŠ” "ì¸ì¦ ì½”ë“œ"ê°€ í¬í•¨ë˜ì–´ ìžˆë‹¤.
4. í´ë¼ì´ì–¸íŠ¸ ì• í”Œë¦¬ì¼€ì´ì…˜ì€ ì´ ì¸ì¦ ì½”ë“œë¥¼ ì¸ì¦ ì„œë²„ì— ì œì¶œí•œë‹¤. í´ë¼ì´ì–¸íŠ¸ ì• í”Œë¦¬ì¼€ì´ì…˜ì€ ìžì‹ ì˜ í´ë¼ì´ì–¸íŠ¸ ì•„ì´ë””ì™€ ì‹œí¬ë¦¿ì„ í•¨ê»˜ ì œì¶œí•˜ì—¬ ìžì‹ ì„ ì¸ì¦í•œë‹¤.
5. ì¸ì¦ ì„œë²„ëŠ” í´ë¼ì´ì–¸íŠ¸ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì¸ì¦í•˜ê³ , ì¸ì¦ ì½”ë“œë¥¼ í™•ì¸í•œ í›„, ì•¡ì„¸ìŠ¤ í† í°ì„ í´ë¼ì´ì–¸íŠ¸ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ê²Œ ë°œê¸‰í•œë‹¤.
```

### âœ¨Client Credentials
- ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì„œë¹„ìŠ¤ ê³„ì •ì— ì ‘ê·¼í•  ìˆ˜ ìžˆëŠ” ë°©ë²•ì„ ì œê³µí•œë‹¤.
- ì• í”Œë¦¬ì¼€ì´ì…˜ ìžì²´ê°€ ì‚¬ìš©ìžë¥¼ ëŒ€ì‹ í•˜ì—¬ apiì— ì ‘ê·¼í•´ì•¼í•  ë•Œ ì‚¬ìš©ëœë‹¤.
```
https://example.com/token?grant_type=client_credentials&client_id=CLIENT_ID&client_secret=CLIENT_SECRET

```
1. ì• í”Œë¦¬ì¼€ì´ì…˜ì€ client idì™€ client secretë¥¼ ì‚¬ìš©í•˜ì—¬ ì¸ì¦ ì„œë²„ì— ì•¡ì„¸ìŠ¤ í† í°ì„  HTTP POST ìš”ì²­ì„ í•œë‹¤.
2. authorization serverëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ìžê²©ì¦ëª…ì„ ê²€ì¦í•˜ê³  ìžê²©ì¦ëª…ì´ ìœ íš¨í•˜ë©´ ì¸ì¦ ì„œë²„ëŠ” ì•¡ì„¸ìŠ¤ í† í°ì„ ì• í”Œë¦¬ì¼€ì´ì…˜ì— ë°˜í™˜í•œë‹¤.
3. ì• í”Œë¦¬ì¼€ì´ì…˜ì€ ì´ í† í°ì„ ì‚¬ìš©í•˜ì—¬ APIì— ì ‘ê·¼í•˜ê³ , í•„ìš”í•œ ìž‘ì—…ì„ ìˆ˜í–‰í•œë‹¤.
### âœ¨Device Code
- ë¸Œë¼ìš°ì €ê°€ ë¶€ì¡±í•˜ê±°ë‚˜ ìž…ë ¥ì´ ì œí•œëœ ë””ë°”ì´ìŠ¤ë“¤ì´ ì—‘ì‹œìŠ¤ í† í°ì„ íšë“í•˜ê³  ì‚¬ìš©ìž ê³„ì •ì— ì ‘ê·¼í•˜ê¸° ìœ„í•œ ìˆ˜ë‹¨ì„ ì œê³µí•œë‹¤.
- ìŠ¤ë§ˆíŠ¸ í…”ë ˆë¹„ì „ì´ë‚˜ ë¹„ë””ì˜¤ ê²Œìž„ ì½˜ì†”ê³¼ ê°™ì€ í‚¤ë³´ë“œ ìž…ë ¥ì´ ì—†ëŠ” ë””ë°”ì´ìŠ¤ì—ì„œ ìœ ìš©í•˜ë‹¤.
```
POST https://oauth.example.com/device

client_id=CLIENT_id
```
```
{
  "device_code": "IO2RUI3SAH0IQuESHAEBAeYOO8UPAI",
  "user_code": "RSIK-KRAM",
  "verification_uri": "https://example.okta.com/device",
  "interval": 10,
  "expires_in": 1600
}
```

> ì°¸ê³   
https://www.digitalocean.com/community/tutorials/an-introduction-to-oauth-2#client-credentials-flow  
https://aaronparecki.com/oauth-2-simplified/#others  
https://datatracker.ietf.org/doc/html/rfc6749  
