---
title: "íŠ¸ëœì­ì…˜"
pubDatetime: 2024-01-06T09:52:57.000Z
full_path: "src/content/blog/transcation.md"
description: "null"
tags: 
  - "DB"
---

### TOC
## Transaction íŠ¸ëœì­ì…˜

Aê°€ Bì—ê²Œ 20ë§Œì›ì„ `ì´ì²´`í•˜ëŠ” ì‘ì—…ì´ ìˆë‹¤ê³  í•  ë•Œ  

1. A ê³„ì¢Œë¡œë¶€í„° 20ë§Œì› ì¸ì¶œ
2. B ê³„ì¢Œë¡œ 20ë§Œì› ì…ê¸ˆ

1ë²ˆê³¼ 2ë²ˆ ê³¼ì •ì´ ë‘˜ ë‹¤ ì„±ê³µí•´ì•¼ `ì´ì²´` ê°€ ì„±ê³µí•œë‹¤.   

ì´ëŸ¬í•œ ë‹¨ì¼ ì‘ì—…ìœ¼ë¡œ ë¬¶ì–´ì„œ ë‚˜ëˆ ì§ˆ ìˆ˜ ì—†ê²Œ ë§Œë“  ê²ƒì„ íŠ¸ëœì­ì…˜ì´ë¼ê³  ë¶€ë¥¸ë‹¤.  

mysqlë¡œ íŠ¸ëœì­ì…˜ì„ êµ¬í˜„í•´ë³´ê¸°  

```sql
START TRANSATION;   // íŠ¸ëœì­ì…˜ ì‹œì‘
UPDATE account SET balance = balance - 200000 WHERE id = 'A'; 
UPDATE account SET balance = balance + 200000 WHERE id = 'B';
COMMIT; // íŠ¸ëœì­ì…˜ ì™„ë£Œ &ì„±ê³µ
```
`START TRANSACTION` íŠ¸ëœì­ì…˜ì„ ì‹œì‘í•˜ì—¬ ë¡œì§ì„ ìˆ˜í–‰í•œë‹¤.  
`COMMIT`ì€ íŠ¸ëœì­ì…˜ì„ ì¢…ë£Œí•˜ê³  ì§€ê¸ˆê¹Œì§€ ì‘ì—…í•œ ë‚´ìš©ì„ DBì— ì˜êµ¬ì ìœ¼ë¡œ ì €ì¥í•˜ëŠ”ê²ƒì„ ì˜ë¯¸í•œë‹¤.  
ë§Œì•½ ë‹¨ì¼ ì‘ì—… ì¤‘ ì¼ë¶€ë§Œ ì„±ê³µí•œë‹¤ë©´ ì´ì²´ ì‘ì—…ì€ DBì— ë°˜ì˜ë˜ì§€ ì•Šê³  `ROLLBACK`í•œë‹¤.  
`ROLLBACK`ì€ íŠ¸ëœì­ì…˜ì„ ì¢…ë£Œí•˜ê³  ì§€ê¸ˆê¹Œì§€ ì‘ì—…ì„ ëª¨ë‘ ì·¨ì†Œí•˜ê³  íŠ¸ëœì­ì…˜ ì´ì „ ìƒíƒœë¡œ ë˜ëŒë¦¬ëŠ”ê²ƒì„ ì˜ë¯¸í•œë‹¤.  

### ì¼ë°˜ì ì¸ íŠ¸ëœì­ì…˜ ì‚¬ìš©íŒ¨í„´
1. íŠ¸ëœì­ì…˜ ì‹œì‘
2. ë¡œì§ ìˆ˜í–‰
3. ë¬¸ì œê°€ ì—†ë‹¤ë©´ COMMIT
4. ë¬¸ì œê°€ ë°œìƒí–ˆë‹¤ë©´ íŠ¸ëœì­ì…˜ì„ ROLLBACK

### AUTOCOMMIT
`AUTOCOMMIT`ì´ë€ ê°ê°ì˜ SQLë¬¸ì„ ìë™ìœ¼ë¡œ íŠ¸ëœì­ì…˜ ì²˜ë¦¬í•´ì£¼ëŠ”ê²ƒì„ ë§í•œë‹¤. mysqlì—ì„œëŠ” ê¸°ë³¸ì ìœ¼ë¡œ í™œì„±í™” ë˜ì–´ìˆìœ¼ë©° ë‹¤ë¥¸ DBMSì—ì„œë„ ëŒ€ë¶€ë¶„ ê°™ì€ ê¸°ëŠ¥ì„ ì œê³µí•œë‹¤.
SQLë¬¸ì´ ì„±ê³µì ìœ¼ë¡œ ì‹¤í–‰ë˜ë©´ ìë™ìœ¼ë¡œ  `COMMIT` í•˜ê³  ë¬¸ì œê°€ ìƒê¸°ë©´ `ROLLBACK`í•œë‹¤.

mysqlì—ì„œ `AUTOCOMMIT`ì´ í™œì„±í™” ë˜ì–´ìˆëŠ”ì§€ í™•ì¸í•´ë³´ê¸°
```mysql
SELECT @@AUTOCOMMIT;
//1 - í™œì„±í™” 
```
`START TRANSACTION` íŠ¸ëœì­ì…˜ì´ ì‹œì‘ë˜ë©´ ë™ì‹œì— `AUTOCOMMIT`ì€ ë¹„í™œì„±í™” ëœë‹¤.
`COMMIT/ROLLBACK`ê³¼ í•¨ê»˜ íŠ¸ëœì­ì…˜ì´ ì¢…ë£Œë˜ë©´ ì›ë˜ `AUTOCOMMIT`ìƒíƒœë¡œ ëŒì•„ê°„ë‹¤.


## íŠ¸ëœì­ì…˜ì˜ ACID
### Atomicity ì›ìì„±
- ALL or NOTHING : íŠ¸ëœì­ì…˜ì€ ë…¼ë¦¬ì ìœ¼ë¡œ ìª¼ê°œì§ˆ ìˆ˜ ì—†ëŠ” ì‘ì—… ë‹¨ìœ„ì´ê¸° ë•Œë¬¸ì— ë‚´ë¶€ì˜ SQLë¬¸ë“¤ì´ ëª¨ë‘ ì„±ê³µí•´ì•¼ í•œë‹¤.
### Consistency ì¼ê´€ì„±
- íŠ¸ëœì­ì…˜ì˜ ê²°ê³¼ëŠ” í•­ìƒ ì¼ê´€ì„±ì´ ìˆì–´ì•¼ í•œë‹¤. 

### Isolation ë…ë¦½ì„±
- ë‘˜ ì´ìƒì˜ íŠ¸ëœì­ì…˜ì´ ë™ì‹œì— ì‹¤í–‰ë  ë•Œ í•˜ë‚˜ì˜ íŠ¸ëœì­ì…˜ì€ ë‹¤ë¥¸ íŠ¸ëœì­ì…˜ ì—°ì‚°ì— ë¼ì–´ë“¤ ìˆ˜ ì—†ë‹¤.
- DBMSëŠ” ì—¬ëŸ¬ ì¢…ë¥˜ì˜ Isolation levelì„ ì œê³µí•œë‹¤
   - ë†’ìœ¼ë©´ ì—„ê²©í•˜ê²Œ ê²©ë¦¬ì‹œì¼œ ë™ì‹œì„±ì´ ë–¨ì–´ì ¸ DBì˜ ì„±ëŠ¥ì´ ì¤„ì–´ë“¤ê²Œ ëœë‹¤.
### Durability ì˜êµ¬ì„±
- íŠ¸ëœì­ì…˜ì´ ì„±ê³µí•  ê²½ìš° ê²°ê³¼ëŠ” ì˜êµ¬ì ìœ¼ë¡œ ë°˜ì˜ë˜ì–´ì•¼í•œë‹¤.
> ì˜êµ¬ì ìœ¼ë¡œ ì €ì¥ëœë‹¤.
DB ì‹œìŠ¤í…œì— ë¬¸ì œê°€ ìƒê²¨ë„ COMMITëœ íŠ¸ëœì­ì…˜ì€ DBì— ë‚¨ì•„ ìˆëŠ”ë‹¤.(=ë¹„íœ˜ë°œì„± ë©”ëª¨ë¦¬(HDD,SDD..)ì— ì €ì¥í•¨)
### ì½ê¸°ì—ëŠ” íŠ¸ëœì­ì…˜ì„ ì•ˆê±¸ì–´ë„ ë ê¹Œ?

## schedule ìŠ¤ì¼€ì¤„

ex) Aê³„ì¢Œì—ì„œ 20ë§Œì›ì„ Bì—ê²Œ ì´ì²´ í•  ë•Œ 

1. íŠ¸ëœì­ì…˜ ì‹œì‘
2. A ê³„ì¢Œ  read
3. A ê³„ì¢Œ write
4. B ê³„ì¢Œ read
5. B ê³„ì¢Œ write
6. íŠ¸ëœì­ì…˜ ì¢…ë£Œ

íŠ¸ëœì­ì…˜ì—ì„œ  2,3,4,5ì™€ ê°™ì€ ì‘ì—… í•˜ë‚˜í•˜ë‚˜ë¥¼ operationì´ë¼ ë¶€ë¥¸ë‹¤.
`r1(A)-w1(A)-r1(B)-w1(B)-c1` 
operationì„ ê°„ì†Œí™”í•˜ì—¬ í‘œí˜„í•  ìˆ˜ ìˆë‹¤. 1ëŠ” íŠ¸ëœì­ì…˜ ë²ˆí˜¸ë¥¼ ì˜ë¯¸í•œë‹¤. 


ex) Aê°€ Bì—ê²Œ 20ë§Œì›ì„ ì´ì²´í•  ë•Œ Bë„ ë³¸ì¸ ê³„ì¢Œì— 30ë§Œì›ì„ ì…ê¸ˆí•œë‹¤ë©´ ì—¬ëŸ¬ í˜•íƒœì˜ ì‹¤í–‰ì´ ìˆì„ ìˆ˜ ìˆë‹¤.
T1 : Aê°€ Bì—ê²Œ 20ë§Œì› ì´ì²´
T2:  Bê°€ ë³¸ì¸ê³„ì¢Œì— 30ë§Œì› ì…ê¸ˆ
ì´ë ‡ê²Œ ì—¬ëŸ¬ íŠ¸ëœì­ì…˜ë“¤ì´ ë™ì‹œì— ì‹¤í–‰ë  ë•Œ ê° íŠ¸ëœì­ì…˜ì— ì†í•œ operationë“¤ì˜ ì‹¤í–‰ ìˆœì„œë¥¼ `Schedule`ì´ë¼ê³  í•œë‹¤.

schedule1: `r1(A)-w1(A)-r1(B)-w1(B)-c1-r2(B)-r2(B)-c2`  : T1 ì´ ëë‚œ í›„  T2ì‹¤í–‰  
ìŠ¤ì¼€ì¤„1ì€ íŠ¸ëœì­ì…˜ì´ ê²¹ì¹˜ì§€ ì•Šê³  ìˆœì°¨ì ìœ¼ë¡œ ì‹¤í–‰ëœë‹¤.  
ì´ë ‡ê²Œ íŠ¸ëœì­ì…˜ì´ ê²¹ì¹˜ì§€ ì•Šê³  ìˆœì°¨ì ìœ¼ë¡œ  ì‹¤í–‰ë˜ëŠ” ìŠ¤ì¼€ì¤„ì„ `Serial schedule`ì´ë¼ê³  í•œë‹¤.  
r1(A)-w1(A) : ê³„ì¢Œì—ì„œ ì½ì„ ë•Œ I/O ì‘ì—…ì„ í•˜ëŠ” ë™ì•ˆ  cpuëŠ” ë†€ê³ ìˆë‹¤.  
í•œ ë²ˆì— í•˜ë‚˜ì˜ íŠ¸ëœì­ì…˜ë§Œ ì‹¤í–‰ë˜ê¸° ë•Œë¬¸ì— ì¢‹ì€ ì„±ëŠ¥ì„ ë‚¼ ìˆ˜ ì—†ê³  í˜„ì‹¤ì ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ì—†ëŠ” ë°©ì‹ì´ë‹¤.  

schedule3: `r1(A)-w1(A)-r2(B)-w2(B)-c2-r1(B)-w1(B)-c1`: T1 ì‹¤í–‰ ì¤‘ T2 ì‹¤í–‰  
ì´ë ‡ê²Œ íŠ¸ëœì­ì…˜ì´ ê²¹ì³ì„œ ì‹¤í–‰ë˜ëŠ” ìŠ¤ì¼€ì¤„ì„ `Nonserial schedule`ì´ë¼ê³  í•œë‹¤.  
w1(A)-r2(B): I/Oì‘ì—…ì„ í•˜ëŠ” ë™ì•ˆ ë‹¤ë¥¸ íŠ¸ëœì­ì…˜ì„ ì§„í–‰í•œë‹¤.  
ë™ì‹œì„±ì´ ë†’ì•„ì ¸ ê°™ì€ ì‹œê°„ë™ì•ˆ ë” ë§ì€ íŠ¸ëœì­ì…˜ì„ ì²˜ë¦¬í•  ìˆ˜ ìˆì§€ë§Œ ì´ìƒí•œ ê²°ê³¼ê°€ ë‚˜ì˜¬ ìˆ˜ ìˆë‹¤.  

## Nonserial ìŠ¤ì¼€ì¤„ë¡œ ì‹¤í–‰í•´ë„ ì´ìƒí•œ ê²°ê³¼ê°€ ë‚˜ì˜¤ì§€ ì•Šê²Œ í•˜ëŠ” ë²•ì´ ì—†ì„ê¹Œ ?ğŸ§  
: serial scheduleê³¼ ë™ì¼í•œ nonserial scheduleì„ ì‹¤í–‰í•˜ì!   
### Conflict of two operations  
1. ì„œë¡œ ë‹¤ë¥¸ íŠ¸ëœì­ì…˜ ì†Œì† 
2. ê°™ì€ ë°ì´í„°ì— ì ‘ê·¼
3. ìµœì†Œ í•˜ë‚˜ëŠ” write operation
2ê°œì˜ operationì´ ìœ„ ì„¸ê°€ì§€ ì¡°ê±´ì„ ë§Œì¡±í•˜ë©´ conflictì´ë‹¤.  

`r1(A)-w1(A)-r2(B)-w2(B)-c2-r1(B)-w1(B)-c1`  
1. r2(B)-w1(B) : read-write conflict   
2. w2(B)-w1(B) : write-write conflict 
3. w2(B)-r1(B): read-write conflict  
ì´ 3ê°œì˜ conflictê°€ ìˆë‹¤ëŠ” ê±¸ í™•ì¸í•  ìˆ˜ ìˆë‹¤.  

conflict operationì€ ìˆœì„œê°€ ë³€ê²½ë˜ë©´ ê²°ê³¼ë„ ë³€ê²½ëœë‹¤.  

### Conflict equivalent for two schedules  
1 ë‘ ìŠ¤ì¼€ì¤„ì€ ê°™ì€ íŠ¸ëœì­ì…˜ë“¤ì„ ê°€ì§„ë‹¤.  
2. ì–´ë–¤ conflicting operationsì˜ ìˆœì„œë„ ì–‘ìª½ ìŠ¤ì¼€ì¤„ ëª¨ë‘ ë™ì¼í•˜ë‹¤.  
2ê°œì˜ ìŠ¤ì¼€ì¤„ì´ ìœ„ 2ê°€ì§€ì¡°ê±´ì„ ë§Œì¡±í•˜ë©´ `conflict equivalent`ë‹¤.  

schedule2: `r2(B)-r2(B)-c2-r1(A)-w1(A)-r1(B)-w1(B)-c1`  : T2ê°€ ëë‚œ í›„  T1ì‹¤í–‰  
schedule3: `r1(A)-w1(A)-r2(B)-w2(B)-c2-r1(B)-w1(B)-c1`: T1 ì‹¤í–‰ ì¤‘ T2 ì‹¤í–‰  

ë‘ ìŠ¤ì¼€ì¤„ ëª¨ë‘ ê°™ì€ íŠ¸ëœì­ì…˜ë“¤ì„ ê°€ì§€ê³  ìˆë‹¤.  
ë‘ ìŠ¤ì¼€ì¤„ì€ ëª¨ë‘ 3ê°œì˜ ìˆœì„œê°€ ê°™ì€ conflict operationì„ ê°€ì§€ê³  ìˆë‹¤.  
ë‘ ìŠ¤ì¼€ì¤„ì€ `Conflict equivalent`ë‹¤.  

2ë²ˆ ìŠ¤ì¼€ì¤„ì€ serial scheduleì´ê³  3ë²ˆ ìŠ¤ì¼€ì¤„ì€ nonserial scheduleì´ë‹¤.  
ì´ë•Œ nonserial scheuleì¸ 3ë²ˆ ìŠ¤ì¼€ì¤„ì€ serial scheduleê³¼ `conflict equivalent`í•  ë•Œ `conflict serializable`ì´ë¼ê³  í•  ìˆ˜ ìˆë‹¤.  

schedule2: `r2(B)-r2(B)-c2-r1(A)-w1(A)-r1(B)-w1(B)-c1`  : T2ê°€ ëë‚œ í›„  T1ì‹¤í–‰  
schedule4: `r1(A)-w1(A)-r1(B)-r2(B)-w2(B)-c2-w1(B)-c1`: T1 ì‹¤í–‰ ì¤‘ T2 ì‹¤í–‰  
-> ìŠ¤ì¼€ì¤„4ëŠ” ì—…ë°ì´íŠ¸í•œ ë°ì´í„°ê°€ ì‚¬ë¼ì§€ëŠ” `Lost Update`ê°€ ì¼ì–´ë‚œë‹¤.  
ë‘ ìŠ¤ì¼€ì¤„ì€ ëª¨ë‘ ê°™ì€ íŠ¸ëœì­ì…˜ì„ ê°€ì§€ê³  ìˆë‹¤.  
ìŠ¤ì¼€ì¤„4ëŠ” r1(B)-w2(B) conflict operaitonì„ ê°€ì§€ê³  ìˆìœ¼ë‚˜ ìŠ¤ì¼€ì¤„2ëŠ” ìˆœì„œê°€ ë³€ê²½ë˜ì–´ìˆë‹¤.  
ë‘ ìŠ¤ì¼€ì¤„ì€ `Conflict equivalent`í•˜ì§€ ì•Šë‹¤.  

schedule1: `r1(A)-w1(A)-r1(B)-w1(B)-c1-r2(B)-r2(B)-c2`  : T1 ì´ ëë‚œ í›„  T2ì‹¤í–‰  
schedule4: `r1(A)-w1(A)-r1(B)-r2(B)-w2(B)-c2-w1(B)-c1`: T1 ì‹¤í–‰ ì¤‘ T2 ì‹¤í–‰  
ë‘ ìŠ¤ì¼€ì¤„ ëª¨ë‘ ê°™ì€ íŠ¸ëœì­ì…˜ì„ ê°€ì§€ê³  ìˆìœ¼ë‚˜ conflict operation ìˆœì„œê°€ ë‹¤ë¥´ë¯€ë¡œ `Conflict equivalent`í•˜ì§€ ì•Šë‹¤.  
ìŠ¤ì¼€ì¤„4ê°€ ê·¸ ì–´ë–¤ serial scheduleê³¼ë„ `Conflict equivalent`í•˜ì§€ ì•Šì•˜ìœ¼ë¯€ë¡œ `Conflict serializable`í•˜ì§€ ì•Šë‹¤.  


`Conflict serializable`í•œ `nonserial schedule`ì„ í—ˆìš©í•´ ì´ìƒí•œ ê²°ê³¼ê°€ ë‚˜ì˜¤ì§€ ì•Šê³  , ì—¬ëŸ¬ íŠ¸ëœì­ì…˜ì„ ê²¹ì³ì„œ ì‹¤í–‰í•˜ì !  

ì–´ë–¤ ìŠ¤ì¼€ì¤„ì´ í•˜ë‚˜ì˜ serial ìŠ¤ì¼€ì¤„ê³¼ ë™ì¼(equivalent)í•˜ë‹¤ë©´ ì´ ìŠ¤ì¼€ì¤„ì€ serializableí•˜ë‹¤.  



### ì°¸ê³ 
[ì‰¬ìš´ì½”ë“œ-íŠ¸ëœì­ì…˜ì„ ì•„ì‹­ë‹ˆê¹Œ?](https://www.youtube.com/watch?v=sLJ8ypeHGlM&list=PLcXyemr8ZeoREWGhhZi5FZs6cvymjIBVe&index=14)  
[inpa - íŠ¸ëœì­ì…˜ ê°œë… & ì‚¬ìš©](https://inpa.tistory.com/entry/MYSQL-%F0%9F%93%9A-%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98Transaction-%EC%9D%B4%EB%9E%80-%F0%9F%92%AF-%EC%A0%95%EB%A6%AC)  
[Database transaction schedule](https://en.wikipedia.org/wiki/Database_transaction_schedule)  
